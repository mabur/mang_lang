result@{
    start = "NNCB"
    rules = (
        ("CH" \B)
        ("HH" \N)
        ("CB" \H)
        ("NH" \C)
        ("HB" \C)
        ("HC" \B)
        ("HN" \C)
        ("NN" \C)
        ("BH" \H)
        ("NC" \B)
        ("NB" \B)
        ("BN" \B)
        ("BB" \N)
        ("BC" \B)
        ("CC" \N)
        ("CN" \C)
    )
    polymer = start
    n = 10
    while n
        result = ""
        while rest@polymer
            a = first!polymer
            b = second!polymer
            prefix = put_each!((b a) "")
            remaining_rules = rules
            while remaining_rules
                rule = top@remaining_rules
                prefix =
                    if rest@rest@prefix then
                        prefix
                    else if equal?(first!rule prefix) then
                        put_each!((b second!rule a) "")
                    else
                        prefix
                remaining_rules = rest@remaining_rules
            end
            while rest@prefix
                result = put!(top@prefix result)
                prefix = rest@prefix
            end
            polymer = rest@polymer
        end
        result = put!(top@polymer result)
        polymer = reverse!result
        n = dec!n
    end
    result = polymer

    alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    counts = map!(in c out count_item!(c polymer ) alphabet)
    counts = clear_if!(in c out equal?(c 0) counts)
    result = sub!(max!counts min!counts)
} 
